<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>俄罗斯方块</title>
    <style>
        /* 全局样式 - 苹果风格 */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            color: #333;
        }
        
        /* 游戏容器 - 苹果风格卡片设计 */
        .game-container {
            background-color: rgba(255, 255, 255, 0.95);
            padding: 24px;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
            display: flex;
            gap: 24px;
            backdrop-filter: blur(10px);
            max-width: calc(100% - 48px);
            margin: 24px auto;
            height: auto;
            min-height: 300px;
            box-sizing: border-box;
            position: relative;
            flex-wrap: wrap;
            justify-content: center;
            align-items: flex-start;
        }
        
        /* 确保body可以在需要时滚动 */
        body {
            overflow: auto;
        }
        
        /* 适配小屏幕 */
        @media (max-width: 768px) {
            .game-container {
                flex-direction: column;
                align-items: center;
                padding: 16px;
                gap: 16px;
                max-width: calc(100% - 32px);
                margin: 16px auto;
            }
            
            h1 {
                font-size: 24px;
            }
            
            .score {
                font-size: 20px;
            }
            
            .signature {
                font-size: 12px;
                padding: 8px;
            }
        }
        
        /* 右下角署名样式 */
        .signature {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: rgba(0, 0, 0, 0.6);
            color: white;
            padding: 10px 15px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
            z-index: 1000;
            backdrop-filter: blur(5px);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }
        
        /* 游戏区域 */
        .game-area {
            display: flex;
            flex-direction: column;
            gap: 16px;
            width: auto;
            max-width: 100%;
            align-items: center;
            box-sizing: border-box;
            justify-content: center;
            flex-shrink: 0;
        }
        
        /* 信息面板 */
        .info-panel {
            display: flex;
            flex-direction: column;
            gap: 16px;
            min-width: 200px;
            width: auto;
        }
        
        /* 确保游戏容器能够根据内容自动调整大小 */
        body {
            overflow-x: auto;
        }
        
        /* 游戏标题 */
        h1 {
            text-align: center;
            color: #1d1d1f;
            font-weight: 700;
            font-size: 32px;
            margin-bottom: 8px;
            letter-spacing: -0.5px;
        }
        
        /* 分数显示 */
        .score {
            text-align: center;
            font-size: 24px;
            font-weight: 700;
            color: #1d1d1f;
            background: #f2f2f7;
            padding: 12px 24px;
            border-radius: 12px;
            margin-bottom: 8px;
        }
        
        /* 游戏画布 */
        #gameCanvas {
            border: 3px solid #e0e0e0;
            background-color: #1d1d1f;
            display: block;
            margin: 0 auto;
            border-radius: 12px;
            box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.3);
        }
        
        /* 控制面板 */
        .controls {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin-top: 12px;
            flex-wrap: wrap;
            width: 100%;
            max-width: 100%;
        }
        
        /* 按钮样式 - 苹果风格 */
        button {
            padding: 12px 24px;
            font-size: 16px;
            font-weight: 600;
            color: white;
            background-color: #007aff;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            box-shadow: 0 2px 8px rgba(0, 122, 255, 0.3);
            white-space: nowrap;
            min-width: auto;
            flex-shrink: 0;
        }
        
        button:hover {
            background-color: #0056b3;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 122, 255, 0.4);
        }
        
        button:active {
            transform: translateY(0);
            box-shadow: 0 2px 6px rgba(0, 122, 255, 0.3);
        }
        
        /* 适配小屏幕的按钮样式 */
        @media (max-width: 600px) {
            button {
                padding: 10px 18px;
                font-size: 14px;
                border-radius: 10px;
            }
        }
        
        @media (max-width: 400px) {
            button {
                padding: 8px 16px;
                font-size: 12px;
                border-radius: 8px;
            }
            
            .controls {
                gap: 8px;
            }
        }
        
        /* 游戏信息面板 */
        .info-panel {
            display: flex;
            flex-direction: column;
            gap: 16px;
            min-width: 150px;
            max-width: 250px;
            width: auto;
        }
        
        /* 适配小屏幕 - 进一步减小信息面板宽度 */
        @media (max-width: 480px) {
            .info-panel {
                min-width: 120px;
            }
        }
        
        /* 游戏说明和下一个方块容器 */
        .instructions, .next-piece {
            background-color: #f2f2f7;
            padding: 20px;
            border-radius: 16px;
            border: none;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }
        
        .instructions h3, .next-piece h3 {
            color: #1d1d1f;
            margin-bottom: 12px;
            font-size: 18px;
            font-weight: 700;
        }
        
        .instructions ul {
            list-style-type: none;
            padding-left: 0;
        }
        
        .instructions li {
            margin-bottom: 8px;
            font-size: 14px;
            color: #6e6e73;
            display: flex;
            align-items: center;
        }
        
        /* 下一个方块预览 */
        .next-piece {
            text-align: center;
        }
        
        #nextCanvas {
            border: 2px solid #e0e0e0;
            background-color: #1d1d1f;
            display: block;
            margin: 12px auto;
            border-radius: 8px;
        }
        
        /* 难度选择 */
        .difficulty {
            background-color: #f2f2f7;
            padding: 20px;
            border-radius: 16px;
        }
        
        .difficulty h3 {
            color: #1d1d1f;
            margin-bottom: 12px;
            font-size: 18px;
            font-weight: 700;
        }
        
        .difficulty-selector {
            display: flex;
            gap: 8px;
            justify-content: center;
        }
        
        .difficulty-btn {
            padding: 8px 16px;
            font-size: 14px;
            font-weight: 600;
            color: #6e6e73;
            background-color: white;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
        }
        
        .difficulty-btn.active {
            color: white;
            background-color: #007aff;
            border-color: #007aff;
        }
        
        .difficulty-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body>
    <div class="game-container">
        <!-- 游戏区域 -->
        <div class="game-area">
            <h1>俄罗斯方块</h1>
            <div class="score">分数: <span id="score">0</span></div>
            <canvas id="gameCanvas" width="300" height="600"></canvas>
            <div class="controls">
                <button id="startBtn">开始游戏</button>
                <button id="pauseBtn">暂停</button>
                <button id="restartBtn">重新开始</button>
            </div>
        </div>
        
        <!-- 游戏信息面板 -->
        <div class="info-panel">
            <!-- 下一个方块 -->
            <div class="next-piece">
                <h3>下一个方块</h3>
                <canvas id="nextCanvas" width="120" height="120"></canvas>
            </div>
            
            <!-- 难度选择 -->
            <div class="difficulty">
                <h3>难度</h3>
                <div class="difficulty-selector">
                    <button class="difficulty-btn active" data-speed="1000">简单</button>
                    <button class="difficulty-btn" data-speed="700">中等</button>
                    <button class="difficulty-btn" data-speed="400">困难</button>
                    <button class="difficulty-btn" data-speed="200">专家</button>
                </div>
            </div>
            
            <!-- 游戏说明 -->
            <div class="instructions">
                <h3>游戏说明</h3>
                <ul>
                    <li>← → 左右移动</li>
                    <li>↓ 加速下落</li>
                    <li>↑ 旋转方块</li>
                    <li>空格 直接下落</li>
                    <li>开始游戏后自动下落</li>
                    <li>消除一行得100分</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        // 游戏配置
        const COLS = 10; // 游戏板列数
        const ROWS = 20; // 游戏板行数
        let BLOCK_SIZE = 30; // 方块大小（像素）- 动态调整
        const MIN_BLOCK_SIZE = 15; // 最小方块大小
        const MAX_BLOCK_SIZE = 35; // 最大方块大小
        
        // 游戏状态
        let canvas, ctx; // 主画布和上下文
        let nextCanvas, nextCtx; // 下一个方块画布和上下文
        let board; // 游戏板
        let currentPiece; // 当前方块
        let nextPiece; // 下一个方块
        let score = 0; // 分数
        let gameSpeed = 1000; // 初始下落速度（毫秒）
        let baseGameSpeed = 1000; // 基础游戏速度（用于难度调整）
        let gameInterval; // 游戏定时器
        let isPlaying = false; // 游戏是否正在进行
        let canvasScale = 1; // 画布缩放比例
        
        // 方块颜色 - 苹果风格配色
        const COLORS = [
            '#000000', // 空（黑色）
            '#FF2D55', // I型（粉色）
            '#007AFF', // J型（蓝色）
            '#FF9500', // L型（橙色）
            '#FFCC00', // O型（黄色）
            '#34C759', // S型（绿色）
            '#AF52DE', // T型（紫色）
            '#FF3B30'  // Z型（红色）
        ];
        
        // 固定后的统一颜色
        const LOCKED_COLOR = '#8E8E93'; // 灰色 - 苹果风格的统一颜色
        
        // 方块形状定义（7种俄罗斯方块）
        const SHAPES = [
            // I型
            [
                [0, 0, 0, 0],
                [1, 1, 1, 1],
                [0, 0, 0, 0],
                [0, 0, 0, 0]
            ],
            // J型
            [
                [2, 0, 0],
                [2, 2, 2],
                [0, 0, 0]
            ],
            // L型
            [
                [0, 0, 3],
                [3, 3, 3],
                [0, 0, 0]
            ],
            // O型
            [
                [4, 4],
                [4, 4]
            ],
            // S型
            [
                [0, 5, 5],
                [5, 5, 0],
                [0, 0, 0]
            ],
            // T型
            [
                [0, 6, 0],
                [6, 6, 6],
                [0, 0, 0]
            ],
            // Z型
            [
                [7, 7, 0],
                [0, 7, 7],
                [0, 0, 0]
            ]
        ];
        
        // 计算合适的方块大小，根据窗口尺寸动态调整
        function calculateBlockSize() {
            // 获取可用空间，考虑游戏容器的内边距和边距
            const containerWidth = window.innerWidth - 96; // 减去边距和内边距
            const windowHeight = window.innerHeight;
            
            // 计算基于宽度的最大方块大小
            const maxBlockSizeByWidth = Math.floor(containerWidth / COLS);
            // 计算基于高度的最大方块大小
            const maxBlockSizeByHeight = Math.floor((windowHeight - 200) / ROWS);
            
            // 取最小值，确保在窗口内
            let newBlockSize = Math.min(maxBlockSizeByWidth, maxBlockSizeByHeight);
            
            // 限制方块大小在合理范围内
            newBlockSize = Math.max(MIN_BLOCK_SIZE, newBlockSize);
            newBlockSize = Math.min(MAX_BLOCK_SIZE, newBlockSize);
            
            return newBlockSize;
        }
        
        // 调整画布大小，适应缩放
        function resizeCanvas() {
            // 获取游戏容器的可用宽度，考虑窗口大小和边距
            const availableWidth = window.innerWidth - 144; // 减去游戏容器的边距和内边距
            const availableHeight = window.innerHeight - 200; // 减去游戏容器的边距和内边距
            
            // 计算基于可用宽度的最大方块大小
            const maxBlockSizeByWidth = Math.floor(availableWidth / COLS);
            // 计算基于可用高度的最大方块大小
            const maxBlockSizeByHeight = Math.floor(availableHeight / ROWS);
            
            // 取最小值，确保在窗口内
            let newBlockSize = Math.min(maxBlockSizeByWidth, maxBlockSizeByHeight);
            
            // 限制方块大小在合理范围内
            newBlockSize = Math.max(MIN_BLOCK_SIZE, newBlockSize);
            newBlockSize = Math.min(MAX_BLOCK_SIZE, newBlockSize);
            
            BLOCK_SIZE = newBlockSize;
            
            // 更新主画布大小
            const newWidth = COLS * BLOCK_SIZE;
            const newHeight = ROWS * BLOCK_SIZE;
            canvas.width = newWidth;
            canvas.height = newHeight;
            
            // 更新下一个方块画布大小
            const nextCanvasSize = 5 * BLOCK_SIZE;
            nextCanvas.width = nextCanvasSize;
            nextCanvas.height = nextCanvasSize;
            
            // 重新渲染游戏
            drawBoard();
            drawNextPiece();
        }
        
        // 初始化游戏
        function init() {
            // 获取主画布和上下文
            canvas = document.getElementById('gameCanvas');
            ctx = canvas.getContext('2d');
            
            // 获取下一个方块画布和上下文
            nextCanvas = document.getElementById('nextCanvas');
            nextCtx = nextCanvas.getContext('2d');
            
            // 初始化游戏板
            board = createBoard();
            
            // 初始化当前方块和下一个方块
            currentPiece = createPiece();
            nextPiece = createPiece();
            
            // 调整画布大小
            resizeCanvas();
            
            // 渲染初始状态
            drawBoard();
            drawNextPiece();
            
            // 添加事件监听
            document.getElementById('startBtn').addEventListener('click', startGame);
            document.getElementById('pauseBtn').addEventListener('click', pauseGame);
            document.getElementById('restartBtn').addEventListener('click', restartGame);
            document.addEventListener('keydown', handleKeyPress);
            window.addEventListener('resize', resizeCanvas); // 添加窗口大小变化事件监听
            
            // 添加难度选择事件监听
            document.querySelectorAll('.difficulty-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.difficulty-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    baseGameSpeed = parseInt(this.dataset.speed);
                    if (isPlaying) {
                        clearInterval(gameInterval);
                        gameSpeed = baseGameSpeed;
                        gameInterval = setInterval(gameLoop, gameSpeed);
                    }
                });
            });
        }
        
        // 创建游戏板
        function createBoard() {
            const board = [];
            for (let row = 0; row < ROWS; row++) {
                board[row] = [];
                for (let col = 0; col < COLS; col++) {
                    board[row][col] = 0; // 0表示空
                }
            }
            return board;
        }
        
        // 创建随机方块
        function createPiece() {
            const shapeIndex = Math.floor(Math.random() * SHAPES.length);
            const shape = SHAPES[shapeIndex];
            return {
                shape: shape,
                color: shapeIndex + 1, // 颜色索引从1开始
                x: Math.floor(COLS / 2) - Math.floor(shape[0].length / 2),
                y: 0
            };
        }
        
        // 绘制游戏板
        function drawBoard() {
            // 清空画布
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // 绘制游戏板上的方块 - 使用统一颜色
            for (let row = 0; row < ROWS; row++) {
                for (let col = 0; col < COLS; col++) {
                    const colorIndex = board[row][col];
                    if (colorIndex !== 0) {
                        drawBlock(col, row, colorIndex, false); // 固定方块使用统一颜色
                    }
                }
            }
            
            // 绘制当前方块
            drawPiece(currentPiece);
        }
        
        // 绘制单个方块
        function drawBlock(x, y, colorIndex, isCurrentPiece = false) {
            // 如果是固定在游戏板上的方块，使用统一颜色
            // 如果是当前移动的方块，使用原来的颜色
            const color = isCurrentPiece ? COLORS[colorIndex] : LOCKED_COLOR;
            const px = x * BLOCK_SIZE;
            const py = y * BLOCK_SIZE;
            
            // 绘制方块
            ctx.fillStyle = color;
            ctx.fillRect(px, py, BLOCK_SIZE, BLOCK_SIZE);
            
            // 绘制方块边框
            ctx.strokeStyle = '#FFFFFF';
            ctx.lineWidth = 1;
            ctx.strokeRect(px, py, BLOCK_SIZE, BLOCK_SIZE);
        }
        
        // 绘制当前方块
        function drawPiece(piece) {
            for (let row = 0; row < piece.shape.length; row++) {
                for (let col = 0; col < piece.shape[row].length; col++) {
                    if (piece.shape[row][col] !== 0) {
                        const x = piece.x + col;
                        const y = piece.y + row;
                        drawBlock(x, y, piece.color, true); // 当前移动的方块使用原来的颜色
                    }
                }
            }
        }
        
        // 绘制下一个方块
        function drawNextPiece() {
            // 清空下一个方块画布
            nextCtx.clearRect(0, 0, nextCanvas.width, nextCanvas.height);
            
            // 计算预览方块大小，基于当前方块大小的80%
            const previewSize = BLOCK_SIZE * 0.8;
            
            // 计算偏移量，使方块居中显示
            const offsetX = (nextCanvas.width - nextPiece.shape[0].length * previewSize) / 2;
            const offsetY = (nextCanvas.height - nextPiece.shape.length * previewSize) / 2;
            
            // 绘制下一个方块
            for (let row = 0; row < nextPiece.shape.length; row++) {
                for (let col = 0; col < nextPiece.shape[row].length; col++) {
                    if (nextPiece.shape[row][col] !== 0) {
                        const x = offsetX + col * previewSize;
                        const y = offsetY + row * previewSize;
                        
                        // 绘制方块
                        nextCtx.fillStyle = COLORS[nextPiece.color];
                        nextCtx.fillRect(x, y, previewSize, previewSize);
                        
                        // 绘制方块边框
                        nextCtx.strokeStyle = '#FFFFFF';
                        nextCtx.lineWidth = 1;
                        nextCtx.strokeRect(x, y, previewSize, previewSize);
                    }
                }
            }
        }
        
        // 检查碰撞
        function checkCollision(piece, offsetX, offsetY) {
            for (let row = 0; row < piece.shape.length; row++) {
                for (let col = 0; col < piece.shape[row].length; col++) {
                    if (piece.shape[row][col] !== 0) {
                        const newX = piece.x + col + offsetX;
                        const newY = piece.y + row + offsetY;
                        
                        // 检查是否超出边界
                        if (newX < 0 || newX >= COLS || newY >= ROWS) {
                            return true;
                        }
                        
                        // 检查是否与已有方块碰撞
                        if (newY >= 0 && board[newY][newX] !== 0) {
                            return true;
                        }
                    }
                }
            }
            return false;
        }
        
        // 旋转方块
        function rotatePiece(piece) {
            // 深拷贝当前形状
            const rotatedShape = [];
            for (let row = 0; row < piece.shape.length; row++) {
                rotatedShape[row] = [...piece.shape[row]];
            }
            
            // 旋转矩阵
            const rows = rotatedShape.length;
            const cols = rotatedShape[0].length;
            const newShape = [];
            
            for (let col = 0; col < cols; col++) {
                newShape[col] = [];
                for (let row = rows - 1; row >= 0; row--) {
                    newShape[col].push(rotatedShape[row][col]);
                }
            }
            
            // 创建旋转后的临时方块
            const rotatedPiece = {
                ...piece,
                shape: newShape
            };
            
            // 检查旋转后是否碰撞
            if (!checkCollision(rotatedPiece, 0, 0)) {
                return rotatedPiece;
            }
            
            // 如果碰撞，尝试调整位置
            if (!checkCollision(rotatedPiece, -1, 0)) {
                rotatedPiece.x -= 1;
                return rotatedPiece;
            }
            if (!checkCollision(rotatedPiece, 1, 0)) {
                rotatedPiece.x += 1;
                return rotatedPiece;
            }
            
            // 无法旋转
            return piece;
        }
        
        // 将方块固定到游戏板上
        function lockPiece() {
            for (let row = 0; row < currentPiece.shape.length; row++) {
                for (let col = 0; col < currentPiece.shape[row].length; col++) {
                    if (currentPiece.shape[row][col] !== 0) {
                        const x = currentPiece.x + col;
                        const y = currentPiece.y + row;
                        if (y >= 0) {
                            board[y][x] = currentPiece.color;
                        }
                    }
                }
            }
        }
        
        // 消除完整的行
        function clearLines() {
            let linesCleared = 0;
            
            for (let row = ROWS - 1; row >= 0; row--) {
                if (board[row].every(cell => cell !== 0)) {
                    // 移除完整的行
                    board.splice(row, 1);
                    // 在顶部添加新行
                    board.unshift(new Array(COLS).fill(0));
                    // 增加分数
                    linesCleared++;
                    // 重新检查当前行（因为行已下移）
                    row++;
                }
            }
            
            // 更新分数
            if (linesCleared > 0) {
                score += linesCleared * 100;
                document.getElementById('score').textContent = score;
                // 加速游戏
                gameSpeed = Math.max(100, gameSpeed - 50 * linesCleared);
            }
        }
        
        // 检查游戏是否结束
        function checkGameOver() {
            return checkCollision(currentPiece, 0, 0);
        }
        
        // 游戏主循环
        function gameLoop() {
            // 向下移动方块
            if (!checkCollision(currentPiece, 0, 1)) {
                currentPiece.y++;
            } else {
                // 固定方块到游戏板
                lockPiece();
                // 消除完整的行
                clearLines();
                // 生成新方块
                currentPiece = nextPiece;
                nextPiece = createPiece();
                // 更新下一个方块显示
                drawNextPiece();
                // 检查游戏是否结束
                if (checkGameOver()) {
                    endGame();
                    return;
                }
            }
            
            // 渲染游戏板
            drawBoard();
        }
        
        // 开始游戏
        function startGame() {
            if (!isPlaying) {
                isPlaying = true;
                gameSpeed = baseGameSpeed;
                gameInterval = setInterval(gameLoop, gameSpeed);
            }
        }
        
        // 暂停游戏
        function pauseGame() {
            if (isPlaying) {
                isPlaying = false;
                clearInterval(gameInterval);
            } else {
                startGame();
            }
        }
        
        // 重新开始游戏
        function restartGame() {
            // 停止当前游戏
            isPlaying = false;
            clearInterval(gameInterval);
            
            // 重置游戏状态
            score = 0;
            gameSpeed = baseGameSpeed;
            document.getElementById('score').textContent = score;
            
            // 重新初始化游戏板和方块
            board = createBoard();
            currentPiece = createPiece();
            nextPiece = createPiece();
            
            // 重新渲染
            drawBoard();
            drawNextPiece();
        }
        
        // 结束游戏
        function endGame() {
            isPlaying = false;
            clearInterval(gameInterval);
            alert(`游戏结束！你的分数是：${score}`);
        }
        
        // 处理键盘事件
        function handleKeyPress(event) {
            if (!isPlaying) return;
            
            switch (event.key) {
                case 'ArrowLeft':
                    // 左移
                    if (!checkCollision(currentPiece, -1, 0)) {
                        currentPiece.x--;
                        drawBoard();
                    }
                    break;
                case 'ArrowRight':
                    // 右移
                    if (!checkCollision(currentPiece, 1, 0)) {
                        currentPiece.x++;
                        drawBoard();
                    }
                    break;
                case 'ArrowDown':
                    // 加速下落
                    if (!checkCollision(currentPiece, 0, 1)) {
                        currentPiece.y++;
                        drawBoard();
                    }
                    break;
                case 'ArrowUp':
                    // 旋转
                    currentPiece = rotatePiece(currentPiece);
                    drawBoard();
                    break;
                case ' ':
                    // 直接下落到底部
                    while (!checkCollision(currentPiece, 0, 1)) {
                        currentPiece.y++;
                    }
                    drawBoard();
                    // 立即执行下一个方块的生成
                    setTimeout(gameLoop, 50);
                    break;
            }
        }
        
        // 页面加载完成后初始化游戏
        window.addEventListener('load', init);
    </script>
<!-- 右下角署名 -->
    <div class="signature">written by YCS</div>
    </body>
</html>